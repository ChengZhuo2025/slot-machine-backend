# 杜美人管理系统开发规范

## 一、总体原则

### 1.1 设计原则
- **DRY原则**：Don't Repeat Yourself，避免重复代码
- **SOLID原则**：单一职责、开闭原则、里氏替换、接口隔离、依赖倒置
- **约定优于配置**：采用统一的命名和结构约定
- **API优先**：先设计API接口，再实现具体功能
- **数据驱动**：统一的数据模型和字段定义
- **安全第一**：所有涉及设备控制和支付的功能必须确保安全性
- **响应式优先**：统一管理后台必须支持多设备自适应

### 1.2 技术栈规范
- **统一管理后台**：Vue Vben Admin (Vue 3 + Element Plus + TypeScript)
- **商户管理端**：Uni-app + Vue 3 (微信小程序)
- **用户端**：Vue 3 + Vant UI (H5响应式设计)
- **后端**：Node.js + TypeScript + Nest.js
- **数据库**：MySQL 8.0 + Redis 6.0
- **物联网**：MQTT Broker (EMQ X) + 阿里云IoT平台
- **文件存储**：阿里云OSS
- **支付集成**：微信支付 + 支付宝
- **版本控制**：Git + GitLab/GitHub
- **部署方式**：Docker + Nginx

### 1.3 开发环境规范
- **Node.js**：≥ 18.0.0
- **包管理器**：pnpm (推荐) 或 npm
- **IDE**：VS Code + Vetur/Volar 插件
- **浏览器**：Chrome 最新版 (开发调试)

## 二、项目结构规范

### 2.1 整体目录结构
```
smart-lock-system/
├── admin-frontend/          # 统一管理后台
│   ├── src/
│   │   ├── api/             # API接口
│   │   ├── components/      # 公共组件
│   │   ├── layouts/         # 布局组件
│   │   ├── router/          # 路由配置
│   │   ├── stores/          # 状态管理
│   │   ├── utils/           # 工具函数
│   │   └── views/           # 页面组件
│   ├── types/               # TypeScript类型定义
│   └── package.json
├── merchant-frontend/       # 商户小程序
├── user-frontend/           # 用户H5端
├── backend/                 # 后端服务
├── database/                # 数据库相关
├── deploy/                  # 部署配置
└── docs/                    # 项目文档
├── iot-platform/            # 物联网平台
└── tools                    # 开发工具/脚本
```

### 2.2 命名规范

#### 2.2.1 文件命名
- **组件文件**：PascalCase，如 `DeviceList.vue`
- **页面文件**：kebab-case，如 `device-management.vue`
- **工具文件**：camelCase，如 `deviceUtils.ts`
- **常量文件**：UPPER_SNAKE_CASE，如 `API_CONSTANTS.ts`

#### 2.2.2 变量命名
- **变量/函数**：camelCase，如 `deviceId`, `getUserInfo()`
- **常量**：UPPER_SNAKE_CASE，如 `MAX_RETRY_COUNT`
- **组件名**：PascalCase，如 `DeviceStatusCard`
- **接口名**：PascalCase + I前缀，如 `IDeviceInfo`

## 三、代码规范

### 3.1 Vue 3 组件规范

#### 3.1.1 组件结构顺序
```vue
<template>
  <!-- 模板内容 -->
</template>

<script setup lang="ts">
// 1. 导入依赖
// 2. 定义 Props 和 Emits
// 3. 响应式数据
// 4. 计算属性
// 5. 生命周期钩子
// 6. 方法定义
</script>

<style scoped>
/* 样式定义 */
</style>
```

#### 3.1.2 Props 定义规范
```typescript
interface Props {
  deviceId: string
  status?: 'online' | 'offline' | 'maintenance'
  showActions?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  status: 'offline',
  showActions: true
})
```

### 3.2 API 接口规范

#### 3.2.1 接口命名规范
- **获取数据**：`get` + 资源名，如 `getDeviceList`
- **创建数据**：`create` + 资源名，如 `createDevice`
- **更新数据**：`update` + 资源名，如 `updateDevice`
- **删除数据**：`delete` + 资源名，如 `deleteDevice`

#### 3.2.2 请求响应格式
```typescript
// 统一响应格式
interface ApiResponse<T = any> {
  code: number
  message: string
  data: T
  timestamp: number
}

// 分页响应格式
interface PageResponse<T> {
  list: T[]
  total: number
  page: number
  pageSize: number
}
```

### 3.3 状态管理规范

#### 3.3.1 Store 结构
```typescript
// stores/device.ts
export const useDeviceStore = defineStore('device', () => {
  // 状态定义
  const devices = ref<Device[]>([])
  const loading = ref(false)
  
  // 计算属性
  const onlineDevices = computed(() => 
    devices.value.filter(d => d.status === 'online')
  )
  
  // 操作方法
  const fetchDevices = async () => {
    loading.value = true
    try {
      const response = await getDeviceList()
      devices.value = response.data
    } finally {
      loading.value = false
    }
  }
  
  return {
    devices,
    loading,
    onlineDevices,
    fetchDevices
  }
})
```

## 四、UI/UX 规范

### 4.1 设计系统
- **主色调**：#1890ff (蓝色系)
- **成功色**：#52c41a
- **警告色**：#faad14
- **错误色**：#f5222d
- **中性色**：#666666

### 4.2 响应式断点
```scss
// 断点定义
$breakpoints: (
  xs: 0,
  sm: 576px,
  md: 768px,
  lg: 992px,
  xl: 1200px,
  xxl: 1600px
);
```

### 4.3 组件使用规范
- 优先使用 Element Plus 组件
- 自定义组件需要支持主题切换
- 所有表单组件必须支持验证
- 数据展示组件需要支持加载状态

## 五、安全规范

### 5.1 前端安全
- **XSS防护**：所有用户输入必须进行转义
- **CSRF防护**：使用 Token 验证
- **敏感信息**：不在前端存储敏感数据
- **权限控制**：路由级别和按钮级别权限验证

### 5.2 API安全
- **身份验证**：JWT Token + 刷新机制
- **权限验证**：RBAC权限模型
- **数据加密**：敏感数据传输加密
- **接口限流**：防止恶意请求

## 六、测试规范

### 6.1 单元测试
- 使用 Vitest 进行单元测试
- 工具函数测试覆盖率 ≥ 80%
- 关键业务逻辑测试覆盖率 ≥ 90%

### 6.2 集成测试
- API接口测试
- 组件集成测试
- 端到端测试 (E2E)

## 七、部署规范

### 7.1 环境配置
```bash
# 开发环境
NODE_ENV=development
VITE_API_BASE_URL=http://localhost:3000/api
VITE_APP_TITLE=智能开锁管理系统(开发)

# 生产环境
NODE_ENV=production
VITE_API_BASE_URL=https://api.example.com
VITE_APP_TITLE=智能开锁管理系统
```

### 7.2 构建优化
- 代码分割和懒加载
- 静态资源压缩
- CDN加速配置
- 缓存策略设置

## 八、版本管理规范

### 8.1 Git 工作流
- **主分支**：`main` (生产环境)
- **开发分支**：`develop` (开发环境)
- **功能分支**：`feature/功能名称`
- **修复分支**：`hotfix/问题描述`

### 8.2 提交信息规范
```
type(scope): subject

body

footer
```

类型说明：
- `feat`: 新功能
- `fix`: 修复bug
- `docs`: 文档更新
- `style`: 代码格式调整
- `refactor`: 代码重构
- `test`: 测试相关
- `chore`: 构建过程或辅助工具的变动

## 九、性能优化规范

### 9.1 前端性能
- 组件懒加载
- 图片懒加载和压缩
- 防抖和节流处理
- 虚拟滚动 (大数据量)

### 9.2 网络优化
- 请求合并和缓存
- 接口响应时间监控
- CDN静态资源加速
- Gzip压缩

## 十、监控和日志规范

### 10.1 错误监控
- 前端错误收集和上报
- 接口异常监控
- 性能指标监控

### 10.2 日志规范
```typescript
// 日志级别
enum LogLevel {
  ERROR = 'error',
  WARN = 'warn',
  INFO = 'info',
  DEBUG = 'debug'
}

// 日志格式
interface LogEntry {
  level: LogLevel
  message: string
  timestamp: number
  userId?: string
  deviceId?: string
  extra?: Record<string, any>
}
```

---

**注意事项**：
1. 本规范为项目开发的基础标准，所有团队成员必须严格遵守
2. 如需修改规范，需经过团队讨论并更新文档
3. 定期review代码质量，确保规范执行到位
4. 新成员入职时需要学习本规范并通过代码review验收
